<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lot of companies use Facebook for marketing their products. Facebook is mainly built around images. In fact the whole ecosystem is fueled by images. In order to scale for the vast user base of Facebook, they have done a really good job.
So what if you don&rsquo;t want to use your own storage for uploading images and want to use Facebook for Images? It would be so cool, right? There are two benefits:"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="How To Use Facebook Page Albums As Image Source in Django • Kev's 9th blog"><meta property="og:description" content="Lot of companies use Facebook for marketing their products. Facebook is mainly built around images. In fact the whole ecosystem is fueled by images. In order to scale for the vast user base of Facebook, they have done a really good job.
So what if you don&rsquo;t want to use your own storage for uploading images and want to use Facebook for Images? It would be so cool, right? There are two benefits:"><meta property="og:url" content="https://kevinan9.github.io/posts/2014-02-14-how-to-use-facebook-page-albums-as-image-source-in-django/"><meta property="og:site_name" content="Kev's 9th blog"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-02-14T20:39:36+05:30"><meta property="article:modified_time" content="2014-02-14T20:39:36+05:30"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.110.0"><title>How To Use Facebook Page Albums As Image Source in Django • Kev's 9th blog</title><link rel=canonical href=https://kevinan9.github.io/posts/2014-02-14-how-to-use-facebook-page-albums-as-image-source-in-django/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#ffcd00}</style></head><body class='page type-posts layout-post has-sidebar'><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class='widget widget-about sep-after'><header><div class=logo><a href=/><img src=/images/logo.png></a></div><h2 class='title site-title'><a href=/>Kev's 9th blog</a></h2><div class=desc>Coding my life!</div></header></section><section class='widget widget-sidebar_menu sep-after'><nav id=sidebar-menu class='menu sidebar-menu' aria-label='Sidebar Menu'><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class=item><a href=/about/about>About</a></li></ul></div></nav></section><section class='widget widget-taxonomy_cloud sep-after'><header><h4 class='title widget-title'>tags</h4></header><div class='container list-container'><ul class='list taxonomy-cloud'><li><a href=/tags/algorithm/ style=font-size:1em>Algorithm</a></li><li><a href=/tags/bigworld/ style=font-size:1em>BigWorld</a></li><li><a href=/tags/bio/ style=font-size:1em>bio</a></li><li><a href=/tags/devops/ style=font-size:1em>DevOps</a></li><li><a href=/tags/drawing/ style=font-size:1em>Drawing</a></li><li><a href=/tags/goals/ style=font-size:1em>goals</a></li><li><a href=/tags/mmo/ style=font-size:1em>MMO</a></li><li><a href=/tags/motivations/ style=font-size:1em>motivations</a></li><li><a href=/tags/practicing/ style=font-size:1em>Practicing</a></li><li><a href=/tags/seamless/ style=font-size:1em>Seamless</a></li><li><a href=/tags/self/ style=font-size:1em>self</a></li><li><a href=/tags/sketch/ style=font-size:1em>Sketch</a></li><li><a href=/tags/sketching/ style=font-size:1em>Sketching</a></li><li><a href=/tags/ue5/ style=font-size:1em>UE5</a></li></ul></div></section></div><div class=sidebar-overlay></div></div><div class=main><nav id=main-menu class='menu main-menu' aria-label='Main Menu'><div class=container><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class=item><a href=/about/about>About</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class='widget widget-breadcrumbs sep-after'><nav id=breadcrumbs><ol><li><a href=/>Kev's 9th blog</a></li><li><a href=/posts/>Posts</a></li><li><span>How To Use Facebook Page Albums As Image Source in Django</span></li></ol></nav></section></div></div><header id=header class='header site-header'><div class='container sep-after'><div class=header-info><p class='site-title title'>Kev's 9th blog</p><p class='desc site-desc'>Coding my life!</p></div></div></header><main id=content><article lang=en class=entry><header class='header entry-header'><div class='container sep-after'><div class=header-info><h1 class=title>How To Use Facebook Page Albums As Image Source in Django</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2014-02-14T20:39:36+05:30>Feb 14, 2014</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class='container entry-content'><p>Lot of companies use Facebook for marketing their products. Facebook is mainly built around images. In fact the whole ecosystem is fueled by images. In order to scale for the vast user base of Facebook, they have done a really good job.</p><p>So what if you don&rsquo;t want to use your own storage for uploading images and want to use Facebook for Images? It would be so cool, right?
There are two benefits:</p><ul><li>You don&rsquo;t have to spend anytime setting up an app or service to deal with images. Believe me it is a real tough problem to solve given the size and count of images. You can&rsquo;t put a bar on either of these two.</li><li>It gives your users a much user friendly way. They upload images just once on Facebook and it auto-magically appears on your website. Facebook almost never gets down so there is very good chance you will get a 99.9% uptime.</li></ul><p>So, In order to fix this problem last year I created a Ajax based plugins to fetch images from Facebook album. It asked user to enter album URL and name. But there was an issue with this approach. In order to get access to Facebook graph database it has to get access tokens and each access token only last two months. Plus, it collapsed when it faced IE, since there is unsolvable CORS issue with IE &lt; 9 (our 50% client base for that project).</p><p>It was a tough problem to solve. But i finally found some good articles and projects on Internet. One such project was django-fbgallery. It used a really neat approach to get the Facebook images server side and renders it the page purely server side. It not only solved the IE issue, but also the quality and speed of image loading became instant.</p><p>But there was an issue with this app, it used URLS to render the albums and spoiled the pretty URLS that you would like for pages in Django. So I took the core part of the app ( the Facebook interaction part) and made a sweet CMS plugin out of it.</p><p>Here is the code to make it all work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> django.conf <span style=color:#f92672>import</span> settings
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> django.core.cache <span style=color:#f92672>import</span> cache
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib2<span style=color:#f92672>,</span> urllib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> django.utils.simplejson <span style=color:#66d9ef>as</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> django.template <span style=color:#f92672>import</span> defaultfilters
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fql_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://api.Facebook.com/method/fql.query&#39;</span>
</span></span><span style=display:flex><span>cache_expires <span style=color:#f92672>=</span> getattr(settings, <span style=color:#e6db74>&#39;CACHE_EXPIRES&#39;</span>, <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_fql_result</span>(fql):
</span></span><span style=display:flex><span>    cachename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;fbgallery_cache_&#39;</span> <span style=color:#f92672>+</span> defaultfilters<span style=color:#f92672>.</span>slugify(fql)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> cache_expires <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> cache<span style=color:#f92672>.</span>get(cachename)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> data <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>: 
</span></span><span style=display:flex><span>        options <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;query&#39;</span>:fql,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;format&#39;</span>:<span style=color:#e6db74>&#39;json&#39;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        f <span style=color:#f92672>=</span> urllib2<span style=color:#f92672>.</span>urlopen(urllib2<span style=color:#f92672>.</span>Request(fql_url, urllib<span style=color:#f92672>.</span>urlencode(options)))
</span></span><span style=display:flex><span>        response <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>close()  
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(response)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> cache_expires <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            cache<span style=color:#f92672>.</span>set(cachename, data, cache_expires<span style=color:#f92672>*</span><span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>display_album</span>(album_id):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Display a Facebook album
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    First check that the album id belongs to the page id specified
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    fb_id <span style=color:#f92672>=</span> settings<span style=color:#f92672>.</span>FB_PAGE_ID
</span></span><span style=display:flex><span>    fql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select aid, name from album where owner=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74> and aid=&#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;&#34;</span> <span style=color:#f92672>%</span> (fb_id, album_id)
</span></span><span style=display:flex><span>    valid_album <span style=color:#f92672>=</span> get_fql_result(fql)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> valid_album:
</span></span><span style=display:flex><span>        fql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select pid, src, src_small, src_big, caption from photo where aid = &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;  order by created desc&#34;</span> <span style=color:#f92672>%</span> album_id
</span></span><span style=display:flex><span>        album <span style=color:#f92672>=</span> get_fql_result(fql)
</span></span><span style=display:flex><span>        <span style=color:#75715e>#album_detail = [item for item in valid_album]       </span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> album
</span></span></code></pre></div><p>I asked user to enter the album ID and name, then rendered the album using the plugin here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> cms.plugin_base <span style=color:#f92672>import</span> CMSPluginBase
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> cms.plugin_pool <span style=color:#f92672>import</span> plugin_pool
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> django.utils.translation <span style=color:#f92672>import</span> ugettext_lazy <span style=color:#66d9ef>as</span> _
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Facebook <span style=color:#f92672>import</span> display_album
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> models <span style=color:#f92672>import</span> FacebookGallery
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FacebookGalleryPlugin</span>(CMSPluginBase):
</span></span><span style=display:flex><span>    model <span style=color:#f92672>=</span> FacebookGallery
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> _(<span style=color:#e6db74>&#34;Facebook Album Gallery&#34;</span>)
</span></span><span style=display:flex><span>    render_template <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cmsplugin_fbgallery/album.html&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render</span>(self, context, instance, placeholder):
</span></span><span style=display:flex><span>        album <span style=color:#f92672>=</span> display_album(instance<span style=color:#f92672>.</span>album_id)
</span></span><span style=display:flex><span>        context<span style=color:#f92672>.</span>update({
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;object&#39;</span>: instance,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;album&#39;</span>: album,
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> context
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plugin_pool<span style=color:#f92672>.</span>register_plugin(FacebookGalleryPlugin)
</span></span></code></pre></div><p>You could choose whatever template you want. It&rsquo;s entirely upto you.</p><p>Here is the image of this plugin live in action:</p><p></p><p>The plugin is open sourced here: <a href=https://github.com/changer/cmsplugin-fbgallery>cmsplugin-fbgallery</a> . Feel free to contribute and ask questions.</p></div><footer class=entry-footer><div class='container sep-before'><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/algorithm/>Algorithm</a></div></div></footer></article><nav class=entry-nav><div class=container><div class='next-entry sep-before'><a href=/posts/2014-02-26-simple-state-machine-framework-in-c-number/><span class=screen-reader-text>Next post: </span>Simple State Machine Framework in c#<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav><section id=comments class=comments><div class='container sep-before'><div class=comments-area><script src=https://utteranc.es/client.js repo=kevinan9/kevinan9.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></section></main><footer id=footer class=footer><div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=https://github.com/kevinan9 target=_blank rel='noopener me'><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://linkedin.com/in/yupu-an-0765781 target=_blank rel='noopener me'><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>© 2014-2023 Kevin A.</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script src=/js/custom.js></script></body></html>